<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>TraiCa - Hệ thống theo dõi trại cá</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
    .input-group {
        position: relative;
        margin-bottom: 8px;
    }
    .input-group input {
        width: 100%;
        padding: 14px 12px 14px 12px;
        background: #222;
        border: 1.5px solid #4a90e2;
        border-radius: 8px;
        color: #fff;
        font-size: 16px;
        outline: none;
        transition: border-color 0.2s;
    }
    .input-group input:focus {
        border-color: #2196f3;
    }
    .floating-label {
        position: absolute;
        left: 16px;
        top: 10px;
        color: #90caf9;
        background: transparent;
        font-size: 15px;
        pointer-events: none;
        transition: 0.2s;
        padding: 0 4px;
    }
    .input-group input:focus + .floating-label,
    .input-group input:not(:placeholder-shown) + .floating-label,
    .input-group input:not([value=""]) + .floating-label {
        top: -12px;
        left: 8px;
        font-size: 13px;
        color: #4a90e2;
        background: #181818;
        padding: 0 4px;
    }
    </style>
</head>
<body>
        <!-- Login/Register Modal -->
    <div id="auth-modal" class="modal" style="display: flex; flex-direction: column; align-items: center; justify-content: center; position: fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.8); z-index:1000;">
        <div style="background:#181818; padding:32px 24px; border-radius:12px; min-width:340px; box-shadow:0 2px 16px #0006;">
            <h2 style="text-align:center; color:#fff; margin-bottom:24px;">Đăng nhập hệ thống</h2>
            <form id="login-form" style="display:flex; flex-direction:column; gap:20px; margin-bottom:20px;">
                <div class="input-group">
                    <input type="text" id="login-username" required autocomplete="username" placeholder=" ">
                    <label for="login-username" class="floating-label">Email or phone</label>
                </div>
                <div class="input-group">
                    <input type="password" id="login-password" required autocomplete="current-password" placeholder=" ">
                    <label for="login-password" class="floating-label">Password</label>
                </div>
                <button type="submit" class="btn btn-primary" style="border-radius:8px;">Đăng nhập</button>
            </form>
            <div style="text-align:center; margin-bottom:8px; color:#ccc;">Chưa có tài khoản?</div>
            <form id="register-form" style="display:flex; flex-direction:column; gap:20px;">
                <div class="input-group">
                    <input type="text" id="register-username" required autocomplete="username" placeholder=" ">
                    <label for="register-username" class="floating-label">Email or phone</label>
                </div>
                <div class="input-group">
                    <input type="password" id="register-password" required autocomplete="new-password" placeholder=" ">
                    <label for="register-password" class="floating-label">Password</label>
                </div>
                <button type="submit" class="btn btn-success" style="border-radius:8px;">Đăng ký</button>
            </form>
            <div id="auth-message" style="color:#ff5252; margin-top:16px; text-align:center;"></div>
        </div>
    </div>
    
    <div id="dashboard" style="display: none;">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <i class="fas fa-fish"></i>
                TraiCa
            </div>
            <button class="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                Logout
            </button>   
        </div>

        <!-- Main Container -->
        <div class="container">
            <h1 class="title">Dashboard</h1>
            <p class="subtitle">Welcome back, Quản lý hệ thống trại cá thông minh</p>

            <!-- Dashboard Grid -->
            <div class="dashboard-grid">
                <!-- Left Panel - Báo Cáo Trại Cá -->
                <div class="card">
                    <div class="card-title">
                    <i class="fas fa-chart-line"></i>
                    Báo Cáo Trại Cá
                </div>
                
                <!-- Status Grid -->
                <div class="status-grid">
                    <div class="status-item">
                        <div class="status-icon">
                            <i class="fas fa-utensils"></i>
                        </div>
                        <div class="status-label">Lượng thức ăn còn lại</div>
                        <div class="status-value" id="food-percentage">---%</div>
                        <div class="status-detail" id="food-status">---</div>
                    </div>
                    
                    <div class="status-item">
                        <div class="status-icon">
                            <i class="fas fa-tint"></i>
                        </div>
                        <div class="status-label">Độ đục của nước</div>
                        <div class="status-value" id="water-quality">---</div>
                        <div class="status-detail" id="water-status">---</div>
                    </div>

                    <div class="status-item">
                        <div class="status-icon">
                            <i class="fas fa-thermometer-half"></i>
                        </div>
                        <div class="status-label">Nhiệt độ hiện tại</div>
                        <div class="status-value" id="current-temperature">-- °C</div>
                    </div>

                    <div class="status-item" style="margin-bottom: 20px;">
                        <div class="status-icon">
                            <i class="fas fa-running"></i>
                        </div>
                        <div class="status-label">Dấu hiệu bất thường</div>
                        <div class="status-value" id="motion-status">Không có</div>
                    </div>
                </div>

            </div>

            <!-- Right Panel - Bảng Điều Khiển -->
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-cogs"></i>
                    Bảng Điều Khiển
                </div>

                <!-- System Status -->
                <div class="system-status">
                    <div class="status-indicator active">
                        <div style="font-weight: bold; color: #4caf50;">Trạng thái hệ thống:</div>
                        <div id="system"> Đang tải...</div>
                    </div>
                    <div class="status-indicator active">
                        <div style="font-weight: bold; color: #4caf50;">Thông báo:</div>
                        <div>Đang bật</div>
                    </div>
                </div>

                <!-- Emergency Controls -->
                <div class="emergency-controls">
                    <button class="emergency-btn shutdown" onclick="emergencyShutdown()">
                        <i class="fas fa-power-off"></i>
                        Tắt hệ thống
                    </button>
                    <button class="emergency-btn alert" onclick="sendAlert()">
                        <i class="fas fa-exclamation-triangle"></i>
                        Tắt thông báo
                    </button>
                </div>

                <!-- Servo Control -->
                <div class="control-panel">
                    <div class="control-label">Điều khiển Servo:</div>
                    <div class="control-buttons">
                        <button class="btn btn-success" onclick="controlServo(1)">
                            <i class="fas fa-play"></i>
                            Bật Servo
                        </button>
                        <button class="btn btn-danger" onclick="controlServo(0)">
                            <i class="fas fa-stop"></i>
                            Tắt Servo
                        </button>
                    </div>
                    <div id="servo-status" style="margin-top: 10px; font-weight: bold;"></div>
                </div>
            </div>
        </div>

        <!-- Chart and Controls -->
        <div class="card">
            <div class="card-title">
                <i class="fas fa-chart-area"></i>
                Biểu đồ nhiệt độ và độ đục theo thời gian
            </div>
            
            <!-- Date Controls -->
            <div class="control-panel">
                <div class="control-group">
                    <label class="control-label">Chọn khoảng thời gian:</label>
                    <div class="control-buttons">
                        <input type="date" id="from-date">
                        <span style="margin: 0 10px; align-self: center;">đến</span>
                        <input type="date" id="to-date">
                        <button class="btn btn-primary" onclick="loadHistory()">
                            <i class="fas fa-filter"></i>
                            Lọc dữ liệu
                        </button>
                        <button class="btn btn-success" onclick="enableRealtime()">
                            <i class="fas fa-broadcast-tower"></i>
                            Thời gian thực
                        </button>
                    </div>
                </div>
            </div>

            <!-- Chart Container -->
            <div class="chart-container">
                <canvas id="myChart" width="600" height="300"></canvas>
            </div>
        </div>
    </div>

    <script src="main.js"></script>
</body>
</html>
